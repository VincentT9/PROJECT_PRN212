<Window x:Class="Wpf_SchoolMedicalManangementSystem.HealthHistoryReportView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Báo cáo Lịch sử Sức khỏe"
        Height="700"
        Width="1000"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                Text="BÁO CÁO LỊCH SỬ SỨC KHỎE"
                   FontSize="24"
                FontWeight="Bold"
                   HorizontalAlignment="Center"
                Margin="0,0,0,20"
                   Foreground="#2E86AB"/>

        <!-- Filter Panel -->
        <Border Grid.Row="1"
                Background="#F8F9FA"
                CornerRadius="5"
                Padding="15"
                Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Student Search -->
                <StackPanel Grid.Row="0"
                        Grid.Column="0"
                        Margin="0,0,10,10">
                    <TextBlock Text="Tìm học sinh:"
                            FontWeight="Medium"
                            Margin="0,0,0,5"/>
                    <TextBox x:Name="txtStudentSearch"
                            Padding="8"
                            Height="35"
                             BorderBrush="#DDD"
                            BorderThickness="1"/>
                </StackPanel>

                <!-- Class Filter -->
                <StackPanel Grid.Row="0"
                        Grid.Column="1"
                        Margin="0,0,10,10">
                    <TextBlock Text="Lớp:"
                            FontWeight="Medium"
                            Margin="0,0,0,5"/>
                    <ComboBox x:Name="cmbClass"
                            Height="35"
                            Padding="8"
                              BorderBrush="#DDD"
                            BorderThickness="1"/>
                </StackPanel>

                <!-- Report Type -->
                <StackPanel Grid.Row="0"
                        Grid.Column="2"
                        Margin="0,0,10,10">
                    <TextBlock Text="Loại báo cáo:"
                            FontWeight="Medium"
                            Margin="0,0,0,5"/>
                    <ComboBox x:Name="cmbReportType"
                            Height="35"
                            Padding="8"
                              DisplayMemberPath="Value"
                            SelectedValuePath="Key"
                              BorderBrush="#DDD"
                            BorderThickness="1"/>
                </StackPanel>

                <!-- Date Range -->
                <StackPanel Grid.Row="1"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Margin="0,0,10,0"
                        Orientation="Horizontal">
                    <TextBlock Text="Từ ngày:"
                            FontWeight="Medium"
                            VerticalAlignment="Center"
                            Margin="0,0,10,0"/>
                    <DatePicker x:Name="dpFromDate"
                            Width="120"
                            Height="35"/>
                    <TextBlock Text="Đến ngày:"
                            FontWeight="Medium"
                            VerticalAlignment="Center"
                            Margin="20,0,10,0"/>
                    <DatePicker x:Name="dpToDate"
                            Width="120"
                            Height="35"/>
                </StackPanel>

                <!-- Buttons -->
                <StackPanel Grid.Row="1"
                        Grid.Column="3"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom">
                    <Button x:Name="btnGenerate"
                            Content="Tạo báo cáo"
                            Padding="15,8"
                            Margin="5,0"
                            Background="#28A745"
                            Foreground="White"
                            BorderThickness="0"
                            Click="BtnGenerate_Click"/>
                    <Button x:Name="btnExport"
                            Content="Xuất Excel"
                            Padding="15,8"
                            Margin="5,0"
                            Background="#17A2B8"
                            Foreground="White"
                            BorderThickness="0"
                            Click="BtnExport_Click"/>
                    <Button x:Name="btnPrint"
                            Content="In báo cáo"
                            Padding="15,8"
                            Margin="5,0"
                            Background="#6C757D"
                            Foreground="White"
                            BorderThickness="0"
                            Click="BtnPrint_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Report Content -->
        <TabControl Grid.Row="2"
                x:Name="tcReports">
            <!-- Health Records Report -->
            <TabItem Header="Hồ sơ Sức khỏe">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Summary Cards -->
                    <UniformGrid Grid.Row="0"
                            Rows="1"
                            Columns="4"
                            Margin="0,0,0,15">
                        <!-- Total Students -->
                        <Border Background="#E3F2FD"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Tổng số học sinh"
                                        FontWeight="Medium"
                                        Foreground="#1976D2"/>
                                <TextBlock x:Name="txtTotalStudents"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#1976D2"/>
                            </StackPanel>
                        </Border>

                        <!-- Students with Health Records -->
                        <Border Background="#E8F5E8"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Có hồ sơ sức khỏe"
                                        FontWeight="Medium"
                                        Foreground="#388E3C"/>
                                <TextBlock x:Name="txtWithHealthRecords"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#388E3C"/>
                            </StackPanel>
                        </Border>

                        <!-- Students with Allergies -->
                        <Border Background="#FFF3E0"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Có dị ứng"
                                        FontWeight="Medium"
                                        Foreground="#F57C00"/>
                                <TextBlock x:Name="txtWithAllergies"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#F57C00"/>
                            </StackPanel>
                        </Border>

                        <!-- Students with Chronic Diseases -->
                        <Border Background="#FCE4EC"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Bệnh mãn tính"
                                        FontWeight="Medium"
                                        Foreground="#C2185B"/>
                                <TextBlock x:Name="txtWithChronicDiseases"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#C2185B"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>

                    <!-- Health Records Data Grid -->
                    <DataGrid Grid.Row="1"
                            x:Name="dgHealthReports"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              RowHeaderWidth="0"
                              AlternatingRowBackground="#F8F9FA">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Mã HS"
                                    Binding="{Binding Student.StudentCode}"
                                    Width="80"/>
                            <DataGridTextColumn Header="Tên học sinh"
                                    Binding="{Binding Student.FullName}"
                                    Width="150"/>
                            <DataGridTextColumn Header="Lớp"
                                    Binding="{Binding Student.Class}"
                                    Width="80"/>
                            <DataGridTextColumn Header="Ngày sinh"
                                    Binding="{Binding Student.DateOfBirth, StringFormat=dd/MM/yyyy}"
                                    Width="100"/>
                            <DataGridTextColumn Header="Chiều cao"
                                    Binding="{Binding Height}"
                                    Width="80"/>
                            <DataGridTextColumn Header="Cân nặng"
                                    Binding="{Binding Weight}"
                                    Width="80"/>
                            <DataGridTextColumn Header="Nhóm máu"
                                    Binding="{Binding BloodType}"
                                    Width="80"/>
                            <DataGridTextColumn Header="Dị ứng"
                                    Binding="{Binding Allergies}"
                                    Width="150"/>
                            <DataGridTextColumn Header="Bệnh mãn tính"
                                    Binding="{Binding ChronicDiseases}"
                                    Width="150"/>
                            <DataGridTextColumn Header="Cập nhật"
                                    Binding="{Binding UpdateAt, StringFormat=dd/MM/yyyy}"
                                    Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Medical Incidents Report -->
            <TabItem Header="Sự kiện Y tế">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Incident Summary Cards -->
                    <UniformGrid Grid.Row="0"
                            Rows="1"
                            Columns="4"
                            Margin="0,0,0,15">
                        <!-- Total Incidents -->
                        <Border Background="#FFEBEE"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Tổng sự kiện"
                                        FontWeight="Medium"
                                        Foreground="#D32F2F"/>
                                <TextBlock x:Name="txtTotalIncidents"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#D32F2F"/>
                            </StackPanel>
                        </Border>

                        <!-- Accidents -->
                        <Border Background="#FFF3E0"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Tai nạn"
                                        FontWeight="Medium"
                                        Foreground="#F57C00"/>
                                <TextBlock x:Name="txtAccidents"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#F57C00"/>
                            </StackPanel>
                        </Border>

                        <!-- Fever Cases -->
                        <Border Background="#E8F5E8"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Sốt"
                                        FontWeight="Medium"
                                        Foreground="#388E3C"/>
                                <TextBlock x:Name="txtFeverCases"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#388E3C"/>
                            </StackPanel>
                        </Border>

                        <!-- Resolved Cases -->
                        <Border Background="#E3F2FD"
                                CornerRadius="5"
                                Padding="15"
                                Margin="5">
                            <StackPanel>
                                <TextBlock Text="Đã giải quyết"
                                        FontWeight="Medium"
                                        Foreground="#1976D2"/>
                                <TextBlock x:Name="txtResolvedCases"
                                        Text="0"
                                        FontSize="24"
                                        FontWeight="Bold"
                                        Foreground="#1976D2"/>
                            </StackPanel>
                        </Border>
                    </UniformGrid>

                    <!-- Medical Incidents Data Grid -->
                    <DataGrid Grid.Row="1"
                            x:Name="dgIncidentReports"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              RowHeaderWidth="0"
                              AlternatingRowBackground="#F8F9FA">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Ngày"
                                    Binding="{Binding IncidentDate, StringFormat=dd/MM/yyyy}"
                                    Width="100"/>
                            <DataGridTextColumn Header="Học sinh"
                                    Binding="{Binding Student.FullName}"
                                    Width="150"/>
                            <DataGridTextColumn Header="Lớp"
                                    Binding="{Binding Student.Class}"
                                    Width="80"/>
                            <DataGridTextColumn Header="Loại sự kiện"
                                    Binding="{Binding IncidentTypeDisplay}"
                                    Width="120"/>
                            <DataGridTextColumn Header="Mô tả"
                                    Binding="{Binding Description}"
                                    Width="200"/>
                            <DataGridTextColumn Header="Hành động"
                                    Binding="{Binding ActionsTaken}"
                                    Width="200"/>
                            <DataGridTextColumn Header="Trạng thái"
                                    Binding="{Binding StatusDisplay}"
                                    Width="100"/>
                            <DataGridTextColumn Header="Nhân viên"
                                    Binding="{Binding MedicalStaff.FullName}"
                                    Width="150"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Statistics Tab -->
            <TabItem Header="Thống kê">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                            Text="BIỂU ĐỒ THỐNG KÊ"
                            FontSize="16"
                            FontWeight="Bold"
                               HorizontalAlignment="Center"
                            Margin="0,0,0,20"
                            Foreground="#2E86AB"/>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Health Statistics -->
                        <Border Grid.Column="0"
                                Background="#F8F9FA"
                                CornerRadius="5"
                                Padding="15"
                                Margin="0,0,10,0">
                            <StackPanel>
                                <TextBlock Text="THỐNG KÊ SỨC KHỎE"
                                        FontWeight="Bold"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,0,15"/>
                                <ListBox x:Name="lstHealthStats"
                                        Height="300"/>
                            </StackPanel>
                        </Border>

                        <!-- Incident Statistics -->
                        <Border Grid.Column="1"
                                Background="#F8F9FA"
                                CornerRadius="5"
                                Padding="15"
                                Margin="10,0,0,0">
                            <StackPanel>
                                <TextBlock Text="THỐNG KÊ SỰ KIỆN Y TẾ"
                                        FontWeight="Bold"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,0,15"/>
                                <ListBox x:Name="lstIncidentStats"
                                        Height="300"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3"
                Height="30"
                Background="#F8F9FA">
            <StatusBarItem>
                <TextBlock x:Name="txtStatus"
                        Text="Sẵn sàng"
                        Foreground="#6C757D"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtReportInfo"
                        Text="Chưa có báo cáo"
                        Foreground="#6C757D"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
