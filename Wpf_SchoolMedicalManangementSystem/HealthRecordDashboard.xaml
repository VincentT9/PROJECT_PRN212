<Page x:Class="Wpf_SchoolMedicalManangementSystem.HealthRecordDashboard"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Bảng điều khiển Hồ sơ Sức khỏe"
      Height="700"
      Width="1200">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                   Text="BẢNG ĐIỀU KHIỂN HỒ SƠ SỨC KHỎE"
                   FontSize="24"
                   FontWeight="Bold"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,20"
                   Foreground="#2E86AB"/>

        <!-- Search and Filter Panel -->
        <Border Grid.Row="1"
                Background="#F8F9FA"
                CornerRadius="5"
                Padding="15"
                Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <StackPanel Grid.Column="0"
                            Margin="0,0,10,0">
                    <TextBlock Text="Tìm kiếm học sinh:"
                               FontWeight="Medium"
                               Margin="0,0,0,5"/>
                    <TextBox x:Name="txtSearch"
                             Padding="8"
                             Height="35"
                             Text="{Binding SearchTerm, UpdateSourceTrigger=PropertyChanged}"
                             BorderBrush="#DDD"
                             BorderThickness="1"/>
                </StackPanel>

                <!-- Class Filter -->
                <StackPanel Grid.Column="1"
                            Margin="0,0,10,0">
                    <TextBlock Text="Lớp:"
                               FontWeight="Medium"
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="cmbClass"
                              Height="35"
                              Padding="8"
                              SelectedValue="{Binding SelectedClass}"
                              BorderBrush="#DDD"
                              BorderThickness="1"/>
                </StackPanel>

                <!-- Health Status Filter -->
                <StackPanel Grid.Column="2"
                            Margin="0,0,10,0">
                    <TextBlock Text="Tình trạng:"
                               FontWeight="Medium"
                               Margin="0,0,0,5"/>
                    <ComboBox x:Name="cmbHealthStatus"
                              Height="35"
                              Padding="8"
                              SelectedValue="{Binding SelectedHealthStatus}"
                              DisplayMemberPath="Value"
                              SelectedValuePath="Key"
                              BorderBrush="#DDD"
                              BorderThickness="1"/>
                </StackPanel>

                <!-- Buttons -->
                <StackPanel Grid.Column="3"
                            VerticalAlignment="Bottom"
                            Orientation="Horizontal">
                    <Button x:Name="btnSearch"
                            Content="Tìm kiếm"
                            Padding="15,8"
                            Margin="5,0"
                            Background="#17A2B8"
                            Foreground="White"
                            BorderThickness="0"
                            Click="BtnSearch_Click"/>
                    <Button x:Name="btnReset"
                            Content="Làm mới"
                            Padding="15,8"
                            Margin="5,0"
                            Background="#6C757D"
                            Foreground="White"
                            BorderThickness="0"
                            Click="BtnReset_Click"/>
                    <Button x:Name="btnAdd"
                            Content="+ Thêm hồ sơ"
                            Padding="15,8"
                            Margin="5,0"
                            Background="#28A745"
                            Foreground="White"
                            BorderThickness="0"
                            Click="BtnAdd_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Health Records List -->
            <DataGrid Grid.Column="0"
                      x:Name="dgHealthRecords"
                      ItemsSource="{Binding HealthRecords}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      RowHeaderWidth="0"
                      AlternatingRowBackground="#F8F9FA"
                      Margin="0,0,10,0"
                      SelectionChanged="DgHealthRecords_SelectionChanged">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Mã HS"
                                        Binding="{Binding Student.StudentCode}"
                                        Width="80"/>
                    <DataGridTextColumn Header="Tên học sinh"
                                        Binding="{Binding Student.FullName}"
                                        Width="150"/>
                    <DataGridTextColumn Header="Lớp"
                                        Binding="{Binding Student.Class}"
                                        Width="80"/>
                    <DataGridTextColumn Header="Chiều cao"
                                        Binding="{Binding Height}"
                                        Width="80"/>
                    <DataGridTextColumn Header="Cân nặng"
                                        Binding="{Binding Weight}"
                                        Width="80"/>
                    <DataGridTextColumn Header="Nhóm máu"
                                        Binding="{Binding BloodType}"
                                        Width="80"/>
                    <DataGridTextColumn Header="Dị ứng"
                                        Binding="{Binding Allergies}"
                                        Width="120"/>
                    <DataGridTextColumn Header="Bệnh mãn tính"
                                        Binding="{Binding ChronicDiseases}"
                                        Width="120"/>
                    <DataGridTextColumn Header="Cập nhật"
                                        Binding="{Binding UpdateAt, StringFormat=dd/MM/yyyy}"
                                        Width="100"/>

                    <DataGridTemplateColumn Header="Thao tác"
                                            Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal"
                                            HorizontalAlignment="Center">
                                    <Button Content="Sửa"
                                            Padding="6,3"
                                            Margin="2"
                                            Background="#FFC107"
                                            Foreground="White"
                                            BorderThickness="0"
                                            Click="BtnEdit_Click"
                                            Tag="{Binding}"/>
                                    <Button Content="Xóa"
                                            Padding="6,3"
                                            Margin="2"
                                            Background="#DC3545"
                                            Foreground="White"
                                            BorderThickness="0"
                                            Click="BtnDelete_Click"
                                            Tag="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Health Record Detail Panel -->
            <Border Grid.Column="1"
                    Background="#F8F9FA"
                    CornerRadius="5"
                    Padding="15">
                <StackPanel x:Name="pnlHealthDetails">
                    <TextBlock Text="CHI TIẾT HỒ SƠ SỨC KHỎE"
                               FontWeight="Bold"
                               FontSize="14"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,15"
                               Foreground="#2E86AB"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  Height="500">
                        <StackPanel x:Name="spHealthDetails">
                            <!-- Student Info -->
                            <TextBlock Text="THÔNG TIN HỌC SINH"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       Foreground="#495057"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0"
                                           Grid.Column="0"
                                           Text="Tên:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="0"
                                           Grid.Column="1"
                                           x:Name="txtDetailName"
                                           Margin="5,0,0,5"/>

                                <TextBlock Grid.Row="1"
                                           Grid.Column="0"
                                           Text="Lớp:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="1"
                                           Grid.Column="1"
                                           x:Name="txtDetailClass"
                                           Margin="5,0,0,5"/>

                                <TextBlock Grid.Row="2"
                                           Grid.Column="0"
                                           Text="Sinh:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="2"
                                           Grid.Column="1"
                                           x:Name="txtDetailBirth"
                                           Margin="5,0,0,5"/>
                            </Grid>

                            <!-- Physical Info -->
                            <TextBlock Text="CHỈ SỐ CƠ THỂ"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       Foreground="#495057"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0"
                                           Grid.Column="0"
                                           Text="Cao:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="0"
                                           Grid.Column="1"
                                           x:Name="txtDetailHeight"
                                           Margin="5,0,0,5"/>

                                <TextBlock Grid.Row="1"
                                           Grid.Column="0"
                                           Text="Nặng:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="1"
                                           Grid.Column="1"
                                           x:Name="txtDetailWeight"
                                           Margin="5,0,0,5"/>

                                <TextBlock Grid.Row="2"
                                           Grid.Column="0"
                                           Text="Máu:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="2"
                                           Grid.Column="1"
                                           x:Name="txtDetailBloodType"
                                           Margin="5,0,0,5"/>
                            </Grid>

                            <!-- Health Conditions -->
                            <TextBlock Text="TÌNH TRẠNG SỨC KHỎE"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       Foreground="#495057"/>

                            <TextBlock Text="Dị ứng:"
                                       FontWeight="Medium"
                                       Margin="0,0,0,5"/>
                            <TextBox x:Name="txtDetailAllergies"
                                     IsReadOnly="True"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     TextWrapping="Wrap"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Bệnh mãn tính:"
                                       FontWeight="Medium"
                                       Margin="0,0,0,5"/>
                            <TextBox x:Name="txtDetailChronicDiseases"
                                     IsReadOnly="True"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     TextWrapping="Wrap"
                                     Margin="0,0,0,10"/>

                            <TextBlock Text="Tiền sử bệnh:"
                                       FontWeight="Medium"
                                       Margin="0,0,0,5"/>
                            <TextBox x:Name="txtDetailMedicalHistory"
                                     IsReadOnly="True"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     TextWrapping="Wrap"
                                     Margin="0,0,0,10"/>

                            <!-- Vision and Hearing -->
                            <TextBlock Text="THỊ LỰC &amp; THÍNH LỰC"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       Foreground="#495057"/>
                            <Grid Margin="0,0,0,15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0"
                                           Grid.Column="0"
                                           Text="Thị lực trái:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="0"
                                           Grid.Column="1"
                                           x:Name="txtDetailVisionLeft"
                                           Margin="5,0,0,5"/>

                                <TextBlock Grid.Row="1"
                                           Grid.Column="0"
                                           Text="Thị lực phải:"
                                           FontWeight="Medium"/>
                                <TextBlock Grid.Row="1"
                                           Grid.Column="1"
                                           x:Name="txtDetailVisionRight"
                                           Margin="5,0,0,5"/>
                            </Grid>

                            <!-- Vaccination -->
                            <TextBlock Text="TIÊM CHỦNG"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       Foreground="#495057"/>
                            <TextBox x:Name="txtDetailVaccination"
                                     IsReadOnly="True"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     TextWrapping="Wrap"
                                     Height="60"
                                     Margin="0,0,0,10"/>

                            <!-- Other Notes -->
                            <TextBlock Text="GHI CHÚ KHÁC"
                                       FontWeight="Bold"
                                       Margin="0,0,0,10"
                                       Foreground="#495057"/>
                            <TextBox x:Name="txtDetailOtherNotes"
                                     IsReadOnly="True"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     TextWrapping="Wrap"
                                     Height="60"/>
                        </StackPanel>
                    </ScrollViewer>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3"
                   Height="30"
                   Background="#F8F9FA">
            <StatusBarItem>
                <TextBlock x:Name="txtStatus"
                           Text="Sẵn sàng"
                           Foreground="#6C757D"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="txtRecordCount"
                           Text="Tổng số: 0 bản ghi"
                           Foreground="#6C757D"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Page>
